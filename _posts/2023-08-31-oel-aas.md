---
layout:       post
title:        "Deploy IBM Open Enterprise Languages-aaS with the easy button ..."
author:       "Anthony Randolph"
header-img:   "img/in-post/post-oel-aas/bg-seaa_framework_automation.png"
catalog:      true
tags:
    - z/OS
    - Ansible
    - Automation
    - Open Source
    - Languages
---
<!-- > Bash on z/OS
![image](https://upload.wikimedia.org/wikipedia/commons/8/82/Gnu-bash-logo.svg) -->

> **Solution Recipe:** Deploy all [IBM Open Enterprise Languages](https://www.ibm.com/docs/en/cloud-paks/z-modernization-stack/2023.2?topic=enhance-zos-applications-open-enterprise-languages) with the easy button ... <br>  ```./run-deploy-oel-dev-env.sh --tags=oel-dev```


Welcome to the sweet solutions blog, in this my first posts, I provide a _`solution-recipe`_ to introduce the Solution Enablement Ansible Automation (SEAA) framework and use it to deploy IBM Open Enterprise Languages as a Service. Let's get started ...

<!-- 
Welcome to the sweet solutions blog page, this is my first posts, my goal is to create post and solutions that will help you in your modernization journey. In this post I will provide a solution-recipe to introduce the Solution Enablement Ansible Automation (SEAA) framework and use it to deploy IBM Open Enterprise Languages as a Service. Let’s get started  -->
# Deploy Open Enterprise Languages-aaS
## _Ingredients_
   - [IBM Open Enterprise Languages](https://www.ibm.com/docs/en/cloud-paks/z-modernization-stack/2023.2?topic=enhance-zos-applications-open-enterprise-languages)
   - [IBM Z and Cloud Modernization Stack](https://www.ibm.com/docs/en/cloud-paks/z-modernization-stack)
   - [IBM z/OS Cloud Broker](https://www.ibm.com/docs/en/cloud-paks/z-modernization-stack/2023.2?topic=broker-zos-cloud-release-notes)
   - [IBM z/OS endpoint](https://www.ibm.com/products/zos)
   - [IBM z/OS Package Manager](https://www.ibm.com/docs/en/cloud-paks/z-modernization-stack/2023.2?topic=manager-release-notes)
   - [RedHat Ansible](https://www.ansible.com/)
   - [RedHat OpenShift](https://www.redhat.com/en/technologies/cloud-computing/openshift)
   - [Solution Enablement Ansible Automation (SEAA) framework](https://github.com/IBM/zmodstack-solutions/blob/main/docs/guide/README.md)
   
   <!-- https://www.ibm.com/docs/en/cloud-paks/z-modernization-stack/2023.2?topic=develop-zos-applications-wazi -->
## _Setting the Table_
### Introduction
IBM Z and Cloud Modernization Stack is a relatively new and exciting offering from IBM that provides multiple components that clients can use as a part of their z/OS modernization journey. The stack has components to assist with modernization existing and new z/OS application development scenarios. For more information on the stacks components see overview [here](https://www.ibm.com/docs/en/cloud-paks/z-modernization-stack/2023.2?topic=overview).

 <!-- Here's a brief description of the stack's components: -->

  <!-- 
     **[IBM Wazi](https://www.ibm.com/docs/en/cloud-paks/z-modernization-stack/2023.2?topic=develop-zos-applications-wazi)** - a complete range of products that allow analysis, development, testing and DevOps on z/OS
     **Wazi Analyze** - native cloud application used to analyze z/OS resources and source code usage patterns
     **Wazi Code** - a set of modern development IDEs and technologies used to develop and test z/OS applications
     **Wazi Deploy** - use DevOps to streamline z/OS application development
     **Wazi Sandbox** - z/OS virtual machine for developing and testing z/OS application 
   **[IBM z/OS Connect EE v3](https://www.ibm.com/docs/en/cloud-paks/z-modernization-stack/2023.2?topic=access-z-assets-zos-connect)** - design open RESTFUL API's for z/OS assets and systems of record and deploy to containerized z/OS Connect EE operator
    **[IBM z/OS Cloud Broker](https://www.ibm.com/docs/en/cloud-paks/z-modernization-stack/2023.2?topic=automate-zos-resources-provisioning-zos-cloud-broker)** - allows developers to develop and deploy RedHat OpenShift operators and maintain state of resources and assets on z/OS endpoints 
  -->

 <!-- In this blog I will dive into a specific use-case of z/OS Cloud Broker and how to use the SEAA framework to automate the deployment of IBM Open Enterprise Languages.  -->
### Solution Overview  
 In this post I will dive into a specific scenario using IBM z/OS Cloud Broker and the SEAA framework to automate the deployment of IBM Open Enterprise Languages, with a single command. The framework leverages native Kubernetes, OpenShift and IBM z/OS Cloud Broker's [API's](https://www.ibm.com/docs/en/cloud-paks/z-modernization-stack/2023.2?topic=azrpzcb-performing-zos-cloud-broker-tasks-via-kubernetes-native-api-calls) and Ansible to deploy resources. The SEAA framework provides a prescriptive model based on [tags](https://github.com/IBM/zmodstack-solutions/blob/main/docs/guide/seaa-tags.md) and configuration [variables](https://github.com/IBM/zmodstack-solutions/blob/main/ibm/seaa/ansible/variables/README.md) provided. These values determine how the automation interacts with the underlying systems and a user. In the following sections I will outline steps that can be used to deploy the IBM Open Enterprise Languages using the SEAA framework.

 <!-- In this post I will dive into a specific use-case of z/OS Cloud Broker and how to use the SEAA framework to automate the deployment of IBM Open Enterprise Languages. To deploy languages as a service for z/OS endpoints the SEAA framework leverages native Kubernetes, OpenShift and IBM z/OS Cloud Broker’s API’s and Ansible to deploy resources. The SEAA framework provides a prescriptive model based on tags and configuration variables provided. These values determine how the automation interacts with the underlying systems and a user. In the following sections I will outline steps that can be used to deploy the IBM Open Enterprise Languages using the SEAA framework -->
### Gather Target Hosts Information
Before jumping in let's gather some information about your target environments ... Make note of the following information as it will be used later to create an Ansible [inventory](https://docs.ansible.com/ansible/latest/inventory_guide/intro_inventory.html) file used by the framework to deploy resources.<br/>

**Step 1:** Get OpenShift host and resource information
- Determine API server for OpenShift cluster
  - <details>
    <summary>Get API Server from OpenShift UI <i><strong> (click to learn more ...) </strong></i> </summary>
    <div class="video-container">
      <video controls autoplay loop muted style="width: 100%;">
      <source src="http://localhost:4000/sweet-solutions/img/in-post/post-oel-aas/ocpabout.mp4" type="video/mp4">
      </video>
    </div>
    </details> 
  - OR - [from Command line](https://github.com/IBM/zmodstack-solutions/blob/main/docs/howto/get-ocp-api-server.md)
    
- Decide on login method to use
  - <details>
    <summary>Get login Auth Token from OpenShift UI<i><strong> (click to learn more ...) </strong></i> </summary>
    <p>If you use this method copy the token provided, it will be used as the `cluster_auth-token` in the inventory file</p>
    <div class="video-container">
      <video controls autoplay loop muted style="width: 100%;">
      <source src="http://localhost:4000/sweet-solutions/img/in-post/post-oel-aas/get_ocpauthtoken.mp4" type="video/mp4">
      </video>
    </div>
    </details> 
  - OR - [use 1Password Integration](https://github.com/IBM/zmodstack-solutions/blob/42c1332ae022f9712695b495d27321731ca2f570/docs/howto/integrate-with-1password-cli.md)

- Determine PVC resource usage
  - If you are planning on using persistent volume storage when deploying IBM z/OS Cloud Broker (**recommend**) 
    -  Determine the `storage class` to use on OpenShift cluster, [volumeMode](https://kubernetes.io/docs/concepts/storage/persistent-volumes/#binding-block-volumes) must be a `FileSystem`. See the [persistent volumes](https://kubernetes.io/docs/concepts/storage/persistent-volumes/) and [storage class](https://kubernetes.io/docs/concepts/storage/storage-classes/) documentation for more info. 
    -  Option 1: The default storage class used by the SEAA framework is `rook-cephfs` and can be changed [here](https://github.com/IBM/zmodstack-solutions/blob/main/ibm/seaa/ansible/variables/defaults/ocp.yaml). 
    -  Option 2: Override per `ocphost` in the `inventory` file or by passing in `pvc_storage_class_name` as an Ansible [extra-vars](https://github.com/IBM/zmodstack-solutions/blob/main/ibm/seaa/ansible/variables/README.md#ansible-extra-vars).
  - Not planning on using persistent volume storage when deploying IBM z/OS Cloud Broker
    - Set broker PVC `broker_instance_storage_configure` and `broker_instance_storage_enabled` variable to `false` [here](https://github.com/IBM/zmodstack-solutions/blob/42c1332ae022f9712695b495d27321731ca2f570/ibm/seaa/ansible/variables/defaults/zoscb.yaml)

**Step 2:** Get z/OS endpoint information
- Create or Select an existing z/OS Endpoint userid and SSH credentials that will be used to connect from OpenShift to the z/OS Endpoint, make sure userid has appropriate [authorization](https://www.ibm.com/docs/en/cloud-paks/z-modernization-stack/2023.2?topic=planning-access-control-requirements-zos) on the z/OS Endpoint to install the desired languages: 
  - Userid for z/OS Endpoint with SSH public key deployed
  - SSH private key file for userid
  - Passphrase for userid (if required)  
- Allocated or select a directory that has at least 8G capacity for the ZPM Install and one that has 4G capacity for the ZPM state directory, see [storage](https://www.ibm.com/docs/en/cloud-paks/z-modernization-stack/2023.2?topic=planning-system-requirements#z-os-storage) requirements topic for more info: 
  - Default ZPM install directory: `/usr/lpp/IBM/zpm`
  - Default ZPM state directory: `/var/zpm`

## _Directions_
 Okay so as you can see I am a really taking this _`solutions recipe`_ thing seriously, now that the table is set let's get the code and deploy some open enterprise languages ...
 
- **Pre-Req:** Get the Code and Preform Setup and Configuration Steps
  - Clone the [zmodstack-solution](https://github.com/IBM/zmodstack-solutions) repo
  - [Setup](https://github.com/IBM/zmodstack-solutions/blob/main/docs/setup/get-started-workstation.md) workstation
  - [Configure](https://github.com/IBM/zmodstack-solutions/blob/main/docs/guide/configure-seaa.md) SEAA framework on your workstation

- **Step 1:** Create an inventory file
  - Copy [sample inventory file](https://github.com/IBM/zmodstack-solutions/blob/main/ibm/seaa/ansible/playbooks/inventory/sample-inventory.yaml) to your default inventory location based on `SEAA_CONFIG_PATH_TO_SE_ANSIBLE_ARTIFACTS` configuration from **Pre-Req** step
    - default location: `${SEAA_CONFIG_PATH_TO_SE_ANSIBLE_ARTIFACTS}/playbooks/inventory`
  - Create a default `inventory.yaml` and update it based on the values decided on from [Gather Target Hosts Information](http://localhost:4000/sweet-solutions/2023/06/29/oel-aas/#planning-target-openshift-and-zos-endpoint-hosts) above.
  
  - See videos for creating and updating inventory file
    <details>
      <summary>- Copying sample inventory and updating 'ocphosts'<i><strong> (click for video ...) </strong></i> </summary>
      <div class="video-container">
        <video controls autoplay loop muted style="width: 100%;">
        <source src="http://localhost:4000/sweet-solutions/img/in-post/post-oel-aas/config_inventory1.mp4" type="video/mp4">
        </video>
      </div>
      </details> 

    <details>
      <summary>- Updating 'zosendpoints'<i><strong> (click for video ...) </strong></i> </summary>
      <div class="video-container">
        <video controls autoplay loop muted style="width: 100%;">
        <source src="http://localhost:4000/sweet-solutions/img/in-post/post-oel-aas/config_inventory2.mp4" type="video/mp4">
        </video>     
      </div>
      </details> 

<!-- ### Deploy OEL -->
- **Step 2** Run script to deploy IBM Open Enterprise Languages
  - By default the SEAA framework will deploy the [current GA](https://github.com/IBM/z-and-cloud-modernization-stack-community) version of the stack ... so no need to change any default variables if you are deploying the current versions of IBM z/OS Cloud Broker, IBM Z/OS Package Manager and IBM Open Enterprise Languages.
  - Open the terminal to the run_scripts directory and run the following command: 
    `./run-deploy-oel-dev-env.sh --tags=oel-dev`
  
<details open>
    <summary> <i>Deploying IBM Open Enterprise Languages-aaS</i> <i><strong> (click to collapse ...) </strong></i> </summary>
    <!-- <summary> <i>./run-deploy-oel-dev-env.sh --tags=oel-dev</i></summary> -->
  
  
  <div class="video-container">
    <video controls autoplay loop muted style="width: 100%;">
    <!-- <source src="http://localhost:4000/sweet-solutions/img/in-post/post-oel-aas/seaa_oel_deploy_final_web.mp4" type="video/webm"> -->
        <source src="http://localhost:4000/sweet-solutions/img/in-post/post-oel-aas/seaa_oel_deploy_final.mp4" type="video/mp4">
    </video>
  </div>
</details>

## _Wrap Up Next Steps_
And with that you're done!!! ... You've successfully used the SEAA framework to deploy IBM Open Enterprise Languages... thanks for following along with my first `solution recipe`, at this point you should have the following deployed resources:

- **On OpenShift**
  - OpenShift Project
    - OpenShift secrets for the z/OS Endpoint user
    - IBM z/OS Cloud Broker Operator and resources
    - IBM z/OS Package Manager Sub-Operator
      - Customer resources for z/OS Products and Validations 

- **On z/OS endpoint**
  - IBM z/OS Package Manager
    - IBM Open Enterprise Languages

The steps outline in this post provided an introduction on how to use the SEAA framework to deploy components of the stack with a single command, there are several other ways the framework can be use to deploy resources to OpenShift and z/OS. 

Okay so full disclosure, in this post I did not show the "easy button", but the command used here can easily be added as apart of a CI/CD pipeline to deploy open enterprise languages-aaS. Additionally, the SEAA framework could be used to 'generate' yaml files that can be deployed and managed from SCM system. Keep an eye out for future solutions post or send me any suggested topics for consideration here - sweet-solutions@gmail.com:

Here are some potential future topics ...
 - Generating YAML for resource deployment
 - Deploying with SEAA framework in OpenShift pipelines
 - Purging IBM Z and Cloud Modernization Stack resources 
 <!-- - Securing Development on WAZI Sandbox  -->
 <!-- - Develop OpenAPI on OpenShift with z/OS Cloud and Modernization Stack  -->

## Special Thanks
I would like to thank Mike Fulton for the motivation and wisdom to create ability to Deploy IBM Open Enterprise Languages-aaS and Igor Todorovski for his assistance on getting this blog site up running.
